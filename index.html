<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pazator. - Mass data container</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: #141313;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: stretch;
            justify-content: stretch;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #e0e0e0;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            min-height: 100vh;
            display: grid;
            grid-template-columns: 4fr 1fr;
            grid-template-rows: 1fr 1fr 2fr;
            gap: 20px;
            padding: 20px;
            background: radial-gradient(circle at top right, #1e1c1c, #141313);
        }

        .panel {
            background: linear-gradient(180deg, #1b1a1a 0%, #191818 100%);
            border: 1px solid #2c2b2b;
            border-radius: 35px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ff6b3944, transparent);
        }

        .conva {
            grid-row: 1 / 4;
            overflow: hidden;
            position: relative;
        }

        .sidebar {
            grid-row: 2 / 4;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 15px;
            border: 1px solid #2c2b2b;
        }

        .sidebar-section h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #ff6b39;
            font-size: 1.2rem;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .tag {
            background: linear-gradient(145deg, #ff6b39, #ff8c5a);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
        }

        .navbar {
            grid-row: 1 / 2;
            display: flex;
            align-items: stretch;
            justify-content: space-between;
            padding: 10px 20px;
            background: linear-gradient(180deg, #1b1a1a 0%, #191818 100%);
            border: 1px solid #2c2b2b;
            border-radius: 35px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .navbar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ff6b3944, transparent);
        }

        .buttons {
            display: flex;
            gap: 10px;
            flex: 1;
        }

        button {
            background: linear-gradient(145deg, #262525, #212020);
            border: 1px solid #444343;
            border-radius: 18px;
            padding: 10px 16px;
            color: #e8e8e8;
            cursor: pointer;
            flex: 1;
            text-align: center;
            align-self: stretch;
            font-size: 1rem;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            border-color: #4a4949;
            background: linear-gradient(145deg, #2a2929, #252424);
        }

        .logo {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2c2b2b;
        }

        .logo h1 {
            font-size: 1.8rem;
            margin: 0;
            background: linear-gradient(45deg, #ff6b39, #ff8c5a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .web-container {
            position: relative;
            width: 100%;
            height: calc(100% - 80px);
            overflow: hidden;
        }

        .data-node {
            position: absolute;
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 1px solid #444;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 10;
            font-size: 10px;
            text-align: center;
            padding: 5px;
            word-break: break-word;
            line-height: 1.2;
        }

        .data-node:hover {
            transform: scale(1.1);
            z-index: 20;
            box-shadow: 0 6px 15px rgba(255, 107, 57, 0.4);
            border-color: #e4714a;
        }

        .data-node.human {
            background: #ff6b39;
        }

        .data-node.other {
            background: linear-gradient(145deg, #ff398f, #ff5aa9);
        }

        .node-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.9);
            color: #e0e0e0;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 30;
            border: 1px solid #444;
        }

        .data-node:hover .node-label {
            opacity: 1;
        }

        .connection-line {
            position: absolute;
            background: rgba(255, 107, 57, 0.4);
            transform-origin: 0 0;
            z-index: 5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: -1;
            justify-content: center;
            align-items: center;
        }

        .modal:target {
            z-index: 1000;
        }

        .modal-content {
            background: linear-gradient(180deg, #1b1a1a 0%, #191818 100%);
            border: 1px solid #2c2b2b;
            border-radius: 25px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #2c2b2b;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            background: linear-gradient(45deg, #ff6b39, #ff8c5a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .close {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 1.8rem;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(0.9);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid #444343;
            border-radius: 12px;
            color: #e0e0e0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #ff6b39;
            box-shadow: 0 0 0 2px rgba(255, 107, 57, 0.3);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        select.form-control {
            height: auto;
            padding: 12px 15px;
        }

        select.form-control[multiple] {
            min-height: 120px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #2c2b2b;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 18px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(145deg, #ff6b39, #ff8c5a);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(145deg, #262525, #212020);
            border: 1px solid #444343;
            color: #e8e8e8;
        }

        .btn-danger {
            background: linear-gradient(145deg, #ff3939, #ff5a5a);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(255, 107, 57, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            border-color: #4a4949;
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(255, 57, 57, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .detail-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: -1;
            justify-content: center;
            align-items: center;
        }

        .detail-content {
            background: linear-gradient(180deg, #1b1a1a 0%, #191818 100%);
            border: 1px solid #2c2b2b;
            border-radius: 25px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2c2b2b;
        }

        .detail-header h2 {
            margin: 0;
            font-size: 1.8rem;
        }

        .detail-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .detail-section h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #ff6b39;
        }

        .detail-item {
            margin-bottom: 12px;
        }

        .detail-label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #aaa;
        }

        .detail-value {
            font-size: 1rem;
            line-height: 1.5;
        }

        .detail-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 12px;
            background: #2a2a2a;
            padding: 10px;
        }

        .family-graph-container {
            grid-column: span 2;
            margin-top: 20px;
            padding: 20px;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 15px;
            border: 1px solid #2c2b2b;
        }

        .family-graph {
            width: 100%;
            height: 300px;
            position: relative;
            overflow: hidden;
        }

        .graph-node {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border: 2px solid #ff6b39;
        }

        .graph-line {
            position: absolute;
            background: #ff6b39;
            transform-origin: 0 0;
            z-index: 5;
        }

        .detail-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #2c2b2b;
        }

        .ai-chat-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: -1;
            justify-content: center;
            align-items: center;
        }

        .ai-chat-content {
            background: linear-gradient(180deg, #1b1a1a 0%, #191818 100%);
            border: 1px solid #2c2b2b;
            border-radius: 25px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .ai-chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2c2b2b;
        }

        .ai-chat-header h2 {
            margin: 0;
            font-size: 1.8rem;
            background: linear-gradient(45deg, #ff6b39, #ff8c5a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 15px;
            margin-bottom: 20px;
            max-height: 50vh;
        }

        .ai-message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            max-width: 80%;
        }

        .ai-message.user {
            background: rgba(255, 107, 57, 0.2);
            margin-left: auto;
        }

        .ai-message.ai {
            background: rgba(57, 143, 255, 0.2);
            margin-right: auto;
        }

        .ai-message.system {
            background: rgba(107, 57, 255, 0.2);
            margin: 0 auto;
            max-width: 100%;
            text-align: left;
            padding: 20px;
            border-radius: 15px;
        }

        .ai-message.system ul {
            text-align: left;
            padding-left: 20px;
            margin: 10px 0;
        }

        .ai-message.system li {
            margin-bottom: 8px;
            text-align: left;
        }

        .ai-message.system p {
            margin: 10px 0;
            text-align: left;
        }

        .ai-input-container {
            display: flex;
            gap: 15px;
        }

        .ai-input {
            flex: 1;
            padding: 15px;
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid #444343;
            border-radius: 12px;
            color: #e0e0e0;
            font-size: 1rem;
        }

        .ai-input:focus {
            outline: none;
            border-color: #ff6b39;
            box-shadow: 0 0 0 2px rgba(255, 107, 57, 0.3);
        }

        .ai-send-btn {
            padding: 15px 25px;
            border-radius: 12px;
            background: linear-gradient(145deg, #ff6b39, #ff8c5a);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .ai-send-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(255, 107, 57, 0.3);
        }

        .ai-send-btn:disabled {
            background: linear-gradient(145deg, #444, #333);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 1200px) {
            .data-node {
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }

            .conva {
                grid-row: 3 / 4;
            }

            .navbar {
                grid-row: 1 / 2;
            }

            .sidebar {
                grid-row: 2 / 3;
            }

            .detail-body {
                grid-template-columns: 1fr;
            }

            .family-graph-container {
                grid-column: s pan 1;
            }

            .ai-input-container {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="panel conva" id="convaPanel">
            <div class="logo">
                <h1>Pazator - MSS</h1>
            </div>
            <div class="web-container" id="webContainer">
            </div>
        </div>
        <div class="panel navbar">
            <div class="buttons">
                <button id="newDataBtn">New data</button>
                <button id="askAIBtn">ask AI</button>
                <button>Menu</button>
            </div>
        </div>
        <div class="panel sidebar">
            <div class="sidebar-section">
                <h3>Search & Filter</h3>
                <div class="form-group">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search entries...">
                </div>
                <div class="form-group">
                    <select id="filterType" class="form-control">
                        <option value="all">All Types</option>
                        <option value="human">Humans</option>
                        <option value="other">Others</option>
                    </select>
                </div>
                <div class="form-group">
                    <button id="applyFilterBtn" class="btn btn-primary" style="width: 100%;">Apply Filter</button>
                </div>
            </div>

            <!-- Tagging System -->
            <div class="sidebar-section">
                <h3>Tags</h3>
                <div class="form-group">
                    <input type="text" id="tagInput" class="form-control" placeholder="Add new tag...">
                </div>
                <div class="form-group">
                    <button id="addTagBtn" class="btn btn-secondary" style="width: 100%;">Add Tag</button>
                </div>
                <div id="tagsContainer" class="tags-container">
                    <!-- Tags will be dynamically added here -->
                </div>
            </div>

            <!-- Data Visualization Enhancements -->
            <div class="sidebar-section">
                <h3>Visualization</h3>
                <div class="form-group">
                    <button id="refreshViewBtn" class="btn btn-secondary"
                        style="width: 100%; margin-bottom: 10px;">Refresh View</button>
                </div>
                <div class="form-group">
                    <button id="toggleConnectionsBtn" class="btn btn-secondary"
                        style="width: 100%; margin-bottom: 10px;">Toggle Connections</button>
                </div>
                <div class="form-group">
                    <button id="showStatisticsBtn" class="btn btn-secondary" style="width: 100%;">Show
                        Statistics</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Type Selection Modal -->
    <div id="typeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Select Data Type</h2>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <p>Choose the type of data you want to create:</p>
                    <div style="display: flex; gap: 20px; margin-top: 25px;">
                        <button id="humanTypeBtn" class="btn btn-primary"
                            style="flex: 1; padding: 20px; font-size: 1.2rem;">
                            Human
                        </button>
                        <button id="otherTypeBtn" class="btn btn-primary"
                            style="flex: 1; padding: 20px; font-size: 1.2rem;">
                            Other
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Human Form Modal -->
    <div id="humanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="humanModalTitle">Create Human Entry</h2>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="humanForm">
                    <input type="hidden" id="humanId">
                    <div class="form-group">
                        <label for="humanName">Name</label>
                        <input type="text" id="humanName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="humanGender">Gender</label>
                        <select id="humanGender" class="form-control">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Non-binary">Non-binary</option>
                            <option value="Other">Other</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="humanTags">Tags</label>
                        <select id="humanTags" class="form-control" multiple size="4">
                            <!-- Tags will be populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="birthDate">Birth Date</label>
                        <input type="date" id="birthDate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="friends">Friends</label>
                        <select id="friends" class="form-control" multiple size="4">
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="family">Family</label>
                        <select id="family" class="form-control" multiple size="4">
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="extraNotes">Extra Notes</label>
                        <textarea id="extraNotes" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="humanImage">Image</label>
                        <input type="file" id="humanImage" class="form-control" accept="image/*">
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelHumanBtn">Cancel</button>
                <button type="submit" class="btn btn-primary" form="humanForm">Save</button>
            </div>
        </div>
    </div>

    <!-- Other Form Modal -->
    <div id="otherModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="otherModalTitle">Create Other Entry</h2>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="otherForm">
                    <input type="hidden" id="otherId">
                    <div class="form-group">
                        <label for="otherName">Name</label>
                        <input type="text" id="otherName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="otherNote">Note</label>
                        <textarea id="otherNote" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="otherImage">Image</label>
                        <input type="file" id="otherImage" class="form-control" accept="image/*">
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelOtherBtn">Cancel</button>
                <button type="submit" class="btn btn-primary" form="otherForm">Save</button>
            </div>
        </div>
    </div>

    <!-- Detail View Modal -->
    <div id="detailViewModal" class="detail-view">
        <div class="detail-content">
            <div class="detail-header">
                <h2 id="detailTitle">Entry Details</h2>
                <button class="close" id="closeDetail">&times;</button>
            </div>
            <div class="detail-body">
                <div class="detail-section">
                    <h3>Basic Information</h3>
                    <div class="detail-item">
                        <div class="detail-label">Name</div>
                        <div id="detailName" class="detail-value"></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Type</div>
                        <div id="detailType" class="detail-value"></div>
                    </div>
                    <div class="detail-item" id="detailGenderContainer">
                        <div class="detail-label">Gender</div>
                        <div id="detailGender" class="detail-value"></div>
                    </div>
                    <div class="detail-item" id="detailBirthDateContainer">
                        <div class="detail-label">Birth Date</div>
                        <div id="detailBirthDate" class="detail-value"></div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>Additional Information</h3>
                    <div class="detail-item" id="detailNotesContainer">
                        <div class="detail-label">Notes</div>
                        <div id="detailNotes" class="detail-value"></div>
                    </div>
                    <div class="detail-item" id="detailTagsContainer">
                        <div class="detail-label">Tags</div>
                        <div id="detailTags" class="detail-value"></div>
                    </div>
                    <div class="detail-item" id="detailFriendsContainer">
                        <div class="detail-label">Friends</div>
                        <div id="detailFriends" class="detail-value"></div>
                    </div>
                    <div class="detail-item" id="detailFamilyContainer">
                        <div class="detail-label">Family</div>
                        <div id="detailFamily" class="detail-value"></div>
                    </div>
                </div>
                <div class="detail-section" id="detailImageContainer">
                    <h3>Image</h3>
                    <div id="detailImagePlaceholder" class="detail-image">No image uploaded</div>
                </div>
                <div class="family-graph-container" id="familyGraphContainer">
                    <h3>Family Relationships</h3>
                    <div class="family-graph" id="familyGraph"></div>
                </div>
            </div>
            <div class="detail-actions">
                <button id="deleteEntryBtn" class="btn btn-danger">Delete</button>
                <button id="editEntryBtn" class="btn btn-primary">Edit</button>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div id="aiChatModal" class="ai-chat-modal">
        <div class="ai-chat-content">
            <div class="ai-chat-header">
                <h2>AI Assistant</h2>
                <button class="close" id="closeAIChat">&times;</button>
            </div>
            <div class="ai-chat-messages" id="aiChatMessages">
                <div class="ai-message system">
                    <h3>Welcome to Pazator AI Assistant</h3>
                    <p>I can help you manage your data. Here's what I can do:</p>
                    <ul>
                        <li>Add new human or other entries</li>
                        <li>Modify existing entries</li>
                        <li>Delete entries</li>
                        <li>Answer questions about your data</li>
                        <li>Create and assign tags to humans</li>
                        <li>Perform multiple actions at once (in proper JSON array format)</li>
                    </ul>
                    <p><strong>Examples:</strong></p>
                    <p>• "Add a new human named John born on 1990-05-15 with tags employee and manager"</p>
                    <p>• "Show me all humans"</p>
                    <p>• "Add two people named John and Jane"</p>
                    <p>• "Give every person a political view" (I'll assign unique views to all humans)</p>
                    <p><strong>Note:</strong> When requesting multiple actions, I need them in proper JSON array format
                        for execution.</p>
                </div>
            </div>
            <div class="ai-input-container">
                <input type="text" class="ai-input" id="aiInput" placeholder="Ask me anything about your data...">
                <button class="ai-send-btn" id="aiSendBtn">Send</button>
            </div>
        </div>
    </div>

    <script src="https://js.puter.com/v2/"></script>
    <script>

        let pazatorData = {
            humans: [],
            others: []
        };

        let tags = [];

        let aiChatHistory = [];

        const newDataBtn = document.getElementById('newDataBtn');
        const askAIBtn = document.getElementById('askAIBtn');
        const typeModal = document.getElementById('typeModal');
        const humanModal = document.getElementById('humanModal');
        const otherModal = document.getElementById('otherModal');
        const detailViewModal = document.getElementById('detailViewModal');
        const aiChatModal = document.getElementById('aiChatModal');
        const webContainer = document.getElementById('webContainer');
        const aiInput = document.getElementById('aiInput');
        const aiSendBtn = document.getElementById('aiSendBtn');
        const aiChatMessages = document.getElementById('aiChatMessages');

        const searchInput = document.getElementById('searchInput');
        const filterType = document.getElementById('filterType');
        const applyFilterBtn = document.getElementById('applyFilterBtn');
        const tagInput = document.getElementById('tagInput');
        const addTagBtn = document.getElementById('addTagBtn');
        const tagsContainer = document.getElementById('tagsContainer');
        const refreshViewBtn = document.getElementById('refreshViewBtn');
        const toggleConnectionsBtn = document.getElementById('toggleConnectionsBtn');
        const showStatisticsBtn = document.getElementById('showStatisticsBtn');

        function saveData() {
            const dataToSave = {
                pazatorData: pazatorData,
                tags: tags
            };
            localStorage.setItem('pazatorData', JSON.stringify(dataToSave));
        }

        function loadData() {
            const storedData = localStorage.getItem('pazatorData');
            if (storedData) {
                const parsedData = JSON.parse(storedData);
                pazatorData = parsedData.pazatorData || { humans: [], others: [] };
                tags = parsedData.tags || [];
            }
            renderWebNodes();
        }

        function renderWebNodes() {

            webContainer.innerHTML = '';

            const searchTerm = searchInput.value.toLowerCase();
            const selectedType = filterType.value;

            let allData = [
                ...pazatorData.humans.map(h => ({ ...h, type: 'human' })),
                ...pazatorData.others.map(o => ({ ...o, type: 'other' }))
            ];

            if (searchTerm) {
                allData = allData.filter(data =>
                    data.name.toLowerCase().includes(searchTerm) ||
                    (data.type === 'human' && data.extraNotes && data.extraNotes.toLowerCase().includes(searchTerm)) ||
                    (data.type === 'other' && data.note && data.note.toLowerCase().includes(searchTerm))
                );
            }

            if (selectedType !== 'all') {
                allData = allData.filter(data => data.type === selectedType);
            }

            allData.forEach((data, index) => {
                const node = document.createElement('div');
                node.className = `data-node ${data.type}`;
                node.dataset.id = data.id;
                node.dataset.type = data.type;

                const containerWidth = webContainer.offsetWidth;
                const containerHeight = webContainer.offsetHeight;
                const nodeSize = 60;
                const spacing = 80;

                const cols = Math.floor(containerWidth / spacing);
                const row = Math.floor(index / cols);
                const col = index % cols;

                const x = col * spacing + (spacing - nodeSize) / 2;
                const y = row * spacing + (spacing - nodeSize) / 2;

                node.style.left = `${x}px`;
                node.style.top = `${y}px`;

                const shortenedName = data.name.length > 8 ? data.name.substring(0, 8) + '...' : data.name;
                node.textContent = shortenedName;

                const label = document.createElement('div');
                label.className = 'node-label';
                label.textContent = data.name;
                node.appendChild(label);

                node.addEventListener('click', () => showDetailView(data, data.type));

                webContainer.appendChild(node);
            });

            drawFamilyConnections();
        }

        function drawFamilyConnections() {

            document.querySelectorAll('.connection-line').forEach(line => line.remove());

            pazatorData.humans.forEach(human => {
                if (human.family && human.family.length > 0) {
                    const humanNode = document.querySelector(`.data-node[data-id="${human.id}"]`);
                    if (!humanNode) return;

                    human.family.forEach(familyId => {
                        const familyNode = document.querySelector(`.data-node[data-id="${familyId}"]`);
                        if (!familyNode) return;

                        const humanRect = humanNode.getBoundingClientRect();
                        const familyRect = familyNode.getBoundingClientRect();
                        const containerRect = webContainer.getBoundingClientRect();

                        const x1 = humanRect.left + humanRect.width / 2 - containerRect.left;
                        const y1 = humanRect.top + humanRect.height / 2 - containerRect.top;
                        const x2 = familyRect.left + familyRect.width / 2 - containerRect.left;
                        const y2 = familyRect.top + familyRect.height / 2 - containerRect.top;

                        const line = document.createElement('div');
                        line.className = 'connection-line';

                        const dx = x2 - x1;
                        const dy = y2 - y1;
                        const length = Math.sqrt(dx * dx + dy * dy);
                        const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                        line.style.width = `${length}px`;
                        line.style.height = '2px';
                        line.style.left = `${x1}px`;
                        line.style.top = `${y1}px`;
                        line.style.transform = `rotate(${angle}deg)`;

                        webContainer.appendChild(line);
                    });
                }
            });
        }

        function showDetailView(data, type) {

            document.currentDetailData = { ...data, type };

            document.getElementById('detailTitle').textContent = `${data.name} - Details`;
            document.getElementById('detailName').textContent = data.name;
            document.getElementById('detailType').textContent = type.charAt(0).toUpperCase() + type.slice(1);

            if (type === 'human') {
                document.getElementById('detailGenderContainer').style.display = 'block';
                document.getElementById('detailGender').textContent = data.gender || 'Not specified';

                document.getElementById('detailBirthDateContainer').style.display = 'block';
                document.getElementById('detailBirthDate').textContent = data.birthDate || 'N/A';

                document.getElementById('detailNotesContainer').style.display = 'block';
                document.getElementById('detailNotes').textContent = data.extraNotes || 'None';

                document.getElementById('detailFriendsContainer').style.display = 'block';
                const friendsList = data.friends && data.friends.length > 0
                    ? data.friends.map(id => getHumanNameById(id)).join(', ')
                    : 'None';
                document.getElementById('detailFriends').textContent = friendsList;

                document.getElementById('detailFamilyContainer').style.display = 'block';
                const familyList = data.family && data.family.length > 0
                    ? data.family.map(id => getHumanNameById(id)).join(', ')
                    : 'None';
                document.getElementById('detailFamily').textContent = familyList;

                const detailTagsContainer = document.getElementById('detailTagsContainer');
                if (detailTagsContainer) {
                    detailTagsContainer.style.display = 'block';
                    const tagsList = data.tags && data.tags.length > 0
                        ? data.tags.join(', ')
                        : 'None';
                    document.getElementById('detailTags').textContent = tagsList;
                }

                document.getElementById('familyGraphContainer').style.display = 'block';
                renderFamilyGraph(data);
            } else {
                document.getElementById('detailGenderContainer').style.display = 'none';
                document.getElementById('detailBirthDateContainer').style.display = 'none';
                document.getElementById('detailFriendsContainer').style.display = 'none';
                document.getElementById('detailFamilyContainer').style.display = 'none';
                document.getElementById('familyGraphContainer').style.display = 'none';

                document.getElementById('detailNotesContainer').style.display = 'block';
                document.getElementById('detailNotes').textContent = data.note || 'None';
            }

            const imageContainer = document.getElementById('detailImageContainer');
            const imagePlaceholder = document.getElementById('detailImagePlaceholder');
            if (data.imagePreview) {
                imageContainer.style.display = 'block';
                imagePlaceholder.outerHTML = `<img id="detailImage" class="detail-image" src="${data.imagePreview}" alt="${data.name}">`;
            } else {
                imageContainer.style.display = 'block';
                imagePlaceholder.textContent = 'No image uploaded';
                imagePlaceholder.style.display = 'flex';
                imagePlaceholder.style.alignItems = 'center';
                imagePlaceholder.style.justifyContent = 'center';
            }

            detailViewModal.style.display = 'flex';
            detailViewModal.style.zIndex = '1000';
        }

        function getHumanNameById(id) {
            const human = pazatorData.humans.find(h => h.id === id);
            return human ? human.name : 'Unknown';
        }

        function renderFamilyGraph(human) {
            const graphContainer = document.getElementById('familyGraph');
            graphContainer.innerHTML = '';

            if (!human.family || human.family.length === 0) {
                graphContainer.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#666;">No family relationships</div>';
                return;
            }

            const centerX = graphContainer.offsetWidth / 2;
            const centerY = graphContainer.offsetHeight / 2;

            const centralNode = document.createElement('div');
            centralNode.className = 'graph-node';
            centralNode.textContent = human.name;
            centralNode.style.left = `${centerX - 40}px`;
            centralNode.style.top = `${centerY - 40}px`;
            centralNode.style.background = 'linear-gradient(145deg, #398fff, #5a9cff)';
            graphContainer.appendChild(centralNode);

            const familyCount = human.family.length;
            human.family.forEach((familyId, index) => {
                const familyMember = pazatorData.humans.find(h => h.id === familyId);
                if (!familyMember) return;

                const angle = (index / familyCount) * Math.PI * 2;
                const distance = 120;
                const x = centerX + Math.cos(angle) * distance - 40;
                const y = centerY + Math.sin(angle) * distance - 40;

                const node = document.createElement('div');
                node.className = 'graph-node';
                node.textContent = familyMember.name;
                node.style.left = `${x}px`;
                node.style.top = `${y}px`;
                node.style.background = 'linear-gradient(145deg, #ff6b39, #ff8c5a)';
                graphContainer.appendChild(node);

                const line = document.createElement('div');
                line.className = 'graph-line';

                const dx = x + 40 - centerX;
                const dy = y + 40 - centerY;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angleDeg = Math.atan2(dy, dx) * 180 / Math.PI;

                line.style.width = `${length}px`;
                line.style.height = '3px';
                line.style.left = `${centerX}px`;
                line.style.top = `${centerY}px`;
                line.style.transform = `rotate(${angleDeg}deg)`;

                graphContainer.appendChild(line);
            });
        }

        function renderTags() {
            tagsContainer.innerHTML = '';

            tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${tag}
                    <span class="remove-tag" data-tag="${tag}">&times;</span>
                `;

                const removeBtn = tagElement.querySelector('.remove-tag');
                removeBtn.addEventListener('click', () => {
                    tags = tags.filter(t => t !== tag);
                    renderTags();
                });

                tagsContainer.appendChild(tagElement);
            });
        }

        function populateSelectOptions(selectedFriends = [], selectedFamily = []) {
            const friendsSelect = document.getElementById('friends');
            const familySelect = document.getElementById('family');

            friendsSelect.innerHTML = '';
            familySelect.innerHTML = '';

            pazatorData.humans.forEach(human => {
                const friendOption = document.createElement('option');
                friendOption.value = human.id;
                friendOption.textContent = human.name;
                if (selectedFriends.includes(human.id)) {
                    friendOption.selected = true;
                }
                friendsSelect.appendChild(friendOption);

                const familyOption = document.createElement('option');
                familyOption.value = human.id;
                familyOption.textContent = human.name;
                if (selectedFamily.includes(human.id)) {
                    familyOption.selected = true;
                }
                familySelect.appendChild(familyOption);
            });
        }

        function populateTagsForHuman(selectedTags = []) {
            const tagsSelect = document.getElementById('humanTags');

            tagsSelect.innerHTML = '';

            tags.forEach(tag => {
                const tagOption = document.createElement('option');
                tagOption.value = tag;
                tagOption.textContent = tag;
                if (selectedTags.includes(tag)) {
                    tagOption.selected = true;
                }
                tagsSelect.appendChild(tagOption);
            });
        }

        function openHumanFormForEdit(human) {
            document.getElementById('humanModalTitle').textContent = 'Edit Human Entry';
            document.getElementById('humanId').value = human.id;
            document.getElementById('humanName').value = human.name;
            document.getElementById('humanGender').value = human.gender || '';
            document.getElementById('birthDate').value = human.birthDate || '';
            document.getElementById('extraNotes').value = human.extraNotes || '';

            populateSelectOptions(human.friends || [], human.family || []);

            populateTagsForHuman(human.tags || []);

            humanModal.style.display = 'flex';
            humanModal.style.zIndex = '1000';
        }

        function openOtherFormForEdit(other) {
            document.getElementById('otherModalTitle').textContent = 'Edit Other Entry';
            document.getElementById('otherId').value = other.id;
            document.getElementById('otherName').value = other.name;
            document.getElementById('otherNote').value = other.note || '';

            otherModal.style.display = 'flex';
            otherModal.style.zIndex = '1000';
        }

        function deleteCurrentEntry() {
            const data = document.currentDetailData;
            if (!data) return;

            if (confirm(`Are you sure you want to delete "${data.name}"?`)) {
                if (data.type === 'human') {
                    pazatorData.humans = pazatorData.humans.filter(h => h.id !== data.id);
                } else {
                    pazatorData.others = pazatorData.others.filter(o => o.id !== data.id);
                }

                saveData();
                renderWebNodes();
                detailViewModal.style.display = 'none';
                detailViewModal.style.zIndex = '-1';
            }
        }

        function addMessageToAIChat(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ${sender}`;
            messageDiv.textContent = message;
            aiChatMessages.appendChild(messageDiv);
            aiChatMessages.scrollTop = aiChatMessages.scrollHeight;

            aiChatHistory.push({ role: sender === 'user' ? 'user' : 'assistant', content: message });
        }

        async function processAICommand(command) {
            command = command.trim();

            addMessageToAIChat(command, 'user');

            aiSendBtn.disabled = true;
            aiSendBtn.textContent = 'Processing...';

            try {

                const context = `
                    You are an AI assistant for the Pazator application. The user wants to manage their data entries.
                    Current data:
                    Humans: ${JSON.stringify(pazatorData.humans)}
                    Others: ${JSON.stringify(pazatorData.others)}
                    Tags: ${JSON.stringify(tags)}

                    The user can ask you to:
                    1. Add new human entries (with name, gender, birth date, friends, family, notes, tags, image)
                    2. Add new other entries (with name, note, image)
                    3. Modify existing entries (including adding/removing tags)
                    4. Delete entries
                    5. Answer questions about the data
                    6. Create tags
                    7. Assign tags to humans

                    When the user wants to perform an action that changes data, respond with a JSON object in this format:
                    {"action": "add_human", "data": {"name": "John", "gender": "Male", "birthDate": "1990-05-15", "friends": [], "family": [], "extraNotes": "", "tags": ["employee", "manager"], "imagePreview": null}}

                    Or respond with an array of JSON objects to perform multiple actions:
                    [{"action": "add_human", "data": {"name": "John", "gender": "Male", "birthDate": "1990-05-15", "tags": ["employee"]}}, {"action": "add_human", "data": {"name": "Jane", "gender": "Female", "birthDate": "1992-08-22", "tags": ["manager"]}}]

                    For multiple modification actions, always use the array format:
                    [{"action": "modify_human", "id": "12345", "data": {"extraNotes": "Political view: Liberal"}}, {"action": "modify_human", "id": "67890", "data": {"extraNotes": "Political view: Conservative"}}]

                    When the user asks to give every person a political view or similar requests, you should:
                    1. Create a unique political view for each human entry
                    2. Return an array of modify_human actions, one for each human
                    3. Use realistic and diverse political views
                    4. Always include all humans in the response, not just one

                    Example response for "Give every person a political view":
                    [{"action": "modify_human", "id": "12345", "data": {"extraNotes": "Political view: Liberal"}}, {"action": "modify_human", "id": "67890", "data": {"extraNotes": "Political view: Conservative"}}, ...]

                    Other action formats:
                    {"action": "add_other", "data": {"name": "ProjectX", "note": "", "imagePreview": null}}
                    {"action": "delete_human", "id": "12345"}
                    {"action": "delete_other", "id": "67890"}
                    {"action": "modify_human", "id": "12345", "data": {"name": "John", "gender": "Male", "birthDate": "1990-05-15", "tags": ["employee", "manager"]}}
                    {"action": "modify_other", "id": "67890", "data": {"name": "ProjectX", "note": "Updated note"}}
                    {"action": "list_humans"}
                    {"action": "list_others"}
                    {"action": "count_entries"}
                    {"action": "add_tag", "tag": "newTag"}
                    {"action": "assign_tag", "id": "12345", "tag": "employee"}
                    {"action": "remove_tag", "id": "12345", "tag": "employee"}

                    For questions that don't require data changes, provide a natural language response.
                    For data modification requests, ONLY respond with the JSON object, nothing else.

                    Previous conversation:
                    ${aiChatHistory.map(msg => `${msg.role}: ${msg.content}`).join('\n')}

                    User request: ${command}
                `;

                const aiResponse = await puter.ai.chat([
                    { role: "system", content: context },
                    { role: "user", content: command }
                ]);

                const responseText = aiResponse.content ? aiResponse.content : aiResponse;

                try {

                    let parsedResponse;
                    try {
                        parsedResponse = JSON.parse(responseText);
                    } catch (parseError) {

                        if (responseText.includes('"action"') && (responseText.match(/\{/g) || []).length > 1) {

                            const jsonObjects = [];
                            let braceCount = 0;
                            let currentObject = '';
                            let inString = false;
                            let escapeNext = false;

                            for (let i = 0; i < responseText.length; i++) {
                                const char = responseText[i];

                                if (escapeNext) {
                                    escapeNext = false;
                                } else if (char === '\\') {
                                    escapeNext = true;
                                } else if (char === '"' && !escapeNext) {
                                    inString = !inString;
                                }

                                if (!inString) {
                                    if (char === '{') {
                                        if (braceCount === 0) {
                                            currentObject = '';
                                        }
                                        braceCount++;
                                    } else if (char === '}') {
                                        braceCount--;
                                        if (braceCount === 0 && currentObject) {
                                            currentObject += char;
                                            try {
                                                const obj = JSON.parse(currentObject);
                                                if (obj.action) { 
                                                    jsonObjects.push(obj);
                                                }
                                            } catch (e) {

                                            }
                                            currentObject = '';
                                            continue;
                                        }
                                    }
                                }

                                if (braceCount > 0) {
                                    currentObject += char;
                                }
                            }

                            if (jsonObjects.length > 0) {
                                parsedResponse = jsonObjects;
                            } else {
                                throw parseError; 
                            }
                        } else {

                            const jsonMatch = responseText.match(/\{[^\}]*\"action\"[^\}]*\}/);
                            if (jsonMatch) {
                                parsedResponse = JSON.parse(jsonMatch[0]);
                            } else {
                                throw parseError; 
                            }
                        }
                    }

                    if (Array.isArray(parsedResponse)) {

                        let completedActions = 0;
                        let totalActions = parsedResponse.length;
                        let batchResponse = "I've completed the following actions:\n";

                        parsedResponse.forEach((action, index) => {
                            switch (action.action) {
                                case "add_human":
                                    const newHuman = {
                                        id: Date.now().toString() + index, 
                                        ...action.data
                                    };
                                    pazatorData.humans.push(newHuman);
                                    batchResponse += `- Added human: ${newHuman.name}\n`;
                                    completedActions++;
                                    break;

                                case "add_other":
                                    const newOther = {
                                        id: Date.now().toString() + index, 
                                        ...action.data
                                    };
                                    pazatorData.others.push(newOther);
                                    batchResponse += `- Added other: ${newOther.name}\n`;
                                    completedActions++;
                                    break;

                                case "modify_human":
                                    const modHumanIndex = pazatorData.humans.findIndex(h => h.id === action.id);
                                    if (modHumanIndex !== -1) {
                                        pazatorData.humans[modHumanIndex] = {
                                            ...pazatorData.humans[modHumanIndex],
                                            ...action.data
                                        };
                                        batchResponse += `- Modified human: ${pazatorData.humans[modHumanIndex].name}\n`;
                                        completedActions++;
                                    }
                                    break;

                                case "modify_other":
                                    const modOtherIndex = pazatorData.others.findIndex(o => o.id === action.id);
                                    if (modOtherIndex !== -1) {
                                        pazatorData.others[modOtherIndex] = {
                                            ...pazatorData.others[modOtherIndex],
                                            ...action.data
                                        };
                                        batchResponse += `- Modified other: ${pazatorData.others[modOtherIndex].name}\n`;
                                        completedActions++;
                                    }
                                    break;

                                default:
                                    handleAIAction(action, true); 
                                    completedActions++;
                            }
                        });

                        if (completedActions > 0) {
                            saveData();
                            renderWebNodes();
                        }

                        batchResponse += `\nCompleted ${completedActions} out of ${totalActions} actions.`;
                        addMessageToAIChat(batchResponse, 'ai');
                        return;
                    } else {

                        handleAIAction(parsedResponse);
                        return;
                    }
                } catch (e) {

                    addMessageToAIChat(responseText, 'ai');
                }
            } catch (error) {
                console.error('AI Error:', error);
                addMessageToAIChat("Sorry, I encountered an error processing your request. Please try again.", 'ai');
            } finally {

                aiSendBtn.disabled = false;
                aiSendBtn.textContent = 'Send';
                aiInput.value = '';
            }
        }

        function handleAIAction(action, isBatch = false) {
            let response = "Action completed.";
            let shouldRespond = !isBatch; 

            switch (action.action) {
                case "add_human":
                    const newHuman = {
                        id: Date.now().toString(),
                        ...action.data
                    };
                    pazatorData.humans.push(newHuman);
                    saveData();
                    renderWebNodes();
                    response = `I've added a new human entry for ${newHuman.name}.`;
                    break;

                case "add_other":
                    const newOther = {
                        id: Date.now().toString(),
                        ...action.data
                    };
                    pazatorData.others.push(newOther);
                    saveData();
                    renderWebNodes();
                    response = `I've added a new other entry named ${newOther.name}.`;
                    break;

                case "delete_human":
                    const humanIndex = pazatorData.humans.findIndex(h => h.id === action.id);
                    if (humanIndex !== -1) {
                        const deletedName = pazatorData.humans[humanIndex].name;
                        pazatorData.humans.splice(humanIndex, 1);
                        saveData();
                        renderWebNodes();
                        response = `I've deleted the human entry for ${deletedName}.`;
                    } else {
                        response = "I couldn't find that human entry to delete.";
                    }
                    break;

                case "delete_other":
                    const otherIndex = pazatorData.others.findIndex(o => o.id === action.id);
                    if (otherIndex !== -1) {
                        const deletedName = pazatorData.others[otherIndex].name;
                        pazatorData.others.splice(otherIndex, 1);
                        saveData();
                        renderWebNodes();
                        response = `I've deleted the other entry for ${deletedName}.`;
                    } else {
                        response = "I couldn't find that other entry to delete.";
                    }
                    break;

                case "modify_human":
                    const modHumanIndex = pazatorData.humans.findIndex(h => h.id === action.id);
                    if (modHumanIndex !== -1) {
                        pazatorData.humans[modHumanIndex] = {
                            ...pazatorData.humans[modHumanIndex],
                            ...action.data
                        };
                        saveData();
                        renderWebNodes();
                        response = `I've updated the human entry for ${pazatorData.humans[modHumanIndex].name}.`;
                    } else {
                        response = "I couldn't find that human entry to modify.";
                    }
                    break;

                case "modify_other":
                    const modOtherIndex = pazatorData.others.findIndex(o => o.id === action.id);
                    if (modOtherIndex !== -1) {
                        pazatorData.others[modOtherIndex] = {
                            ...pazatorData.others[modOtherIndex],
                            ...action.data
                        };
                        saveData();
                        renderWebNodes();
                        response = `I've updated the other entry for ${pazatorData.others[modOtherIndex].name}.`;
                    } else {
                        response = "I couldn't find that other entry to modify.";
                    }
                    break;

                case "list_humans":
                    const humanNames = pazatorData.humans.map(h => h.name).join(', ');
                    response = `Here are your human entries: ${humanNames || 'None'}`;
                    break;

                case "list_others":
                    const otherNames = pazatorData.others.map(o => o.name).join(', ');
                    response = `Here are your other entries: ${otherNames || 'None'}`;
                    break;

                case "count_entries":
                    const humanCount = pazatorData.humans.length;
                    const otherCount = pazatorData.others.length;
                    response = `You have ${humanCount} human entries and ${otherCount} other entries, for a total of ${humanCount + otherCount} entries.`;
                    break;

                case "add_tag":
                    if (action.tag && !tags.includes(action.tag)) {
                        tags.push(action.tag);
                        saveData();
                        renderTags();
                        response = `I've added the tag '${action.tag}' to the tag list.`;
                    } else {
                        response = `The tag '${action.tag}' already exists or is invalid.`;
                    }
                    break;

                case "assign_tag":
                    const humanToTag = pazatorData.humans.findIndex(h => h.id === action.id);
                    if (humanToTag !== -1) {
                        if (!pazatorData.humans[humanToTag].tags) {
                            pazatorData.humans[humanToTag].tags = [];
                        }
                        if (!pazatorData.humans[humanToTag].tags.includes(action.tag)) {
                            pazatorData.humans[humanToTag].tags.push(action.tag);
                            saveData();
                            renderWebNodes();
                            response = `I've assigned the tag '${action.tag}' to ${pazatorData.humans[humanToTag].name}.`;
                        } else {
                            response = `${pazatorData.humans[humanToTag].name} already has the tag '${action.tag}'.`;
                        }
                    } else {
                        response = "I couldn't find that human entry to assign a tag to.";
                    }
                    break;

                case "remove_tag":
                    const humanToRemoveTag = pazatorData.humans.findIndex(h => h.id === action.id);
                    if (humanToRemoveTag !== -1) {
                        if (pazatorData.humans[humanToRemoveTag].tags && pazatorData.humans[humanToRemoveTag].tags.includes(action.tag)) {
                            pazatorData.humans[humanToRemoveTag].tags = pazatorData.humans[humanToRemoveTag].tags.filter(t => t !== action.tag);
                            saveData();
                            renderWebNodes();
                            response = `I've removed the tag '${action.tag}' from ${pazatorData.humans[humanToRemoveTag].name}.`;
                        } else {
                            response = `${pazatorData.humans[humanToRemoveTag].name} doesn't have the tag '${action.tag}'.`;
                        }
                    } else {
                        response = "I couldn't find that human entry to remove a tag from.";
                    }
                    break;

                default:
                    response = "I'm not sure how to help with that request.";
                    shouldRespond = true; 
            }

            if (shouldRespond) {
                addMessageToAIChat(response, 'ai');
            }
        }

        newDataBtn.addEventListener('click', () => {

            document.getElementById('humanModalTitle').textContent = 'Create Human Entry';
            document.getElementById('otherModalTitle').textContent = 'Create Other Entry';

            document.getElementById('humanForm').reset();
            document.getElementById('otherForm').reset();
            document.getElementById('humanId').value = '';
            document.getElementById('otherId').value = '';

            humanModal.style.display = 'none';
            otherModal.style.display = 'none';
            detailViewModal.style.display = 'none';
            aiChatModal.style.display = 'none';

            [humanModal, otherModal, detailViewModal, aiChatModal].forEach(modal => {
                modal.style.zIndex = '-1';
            });

            populateSelectOptions();
            populateTagsForHuman();

            typeModal.style.display = 'flex';
            typeModal.style.zIndex = '1000';
        });

        askAIBtn.addEventListener('click', () => {
            aiChatModal.style.display = 'flex';
            aiChatModal.style.zIndex = '1000';
            aiInput.focus();
        });

        document.querySelectorAll('.close').forEach(button => {
            button.addEventListener('click', (e) => {

                e.stopPropagation();

                typeModal.style.display = 'none';
                humanModal.style.display = 'none';
                otherModal.style.display = 'none';
                detailViewModal.style.display = 'none';
                aiChatModal.style.display = 'none';

                [typeModal, humanModal, otherModal, detailViewModal, aiChatModal].forEach(modal => {
                    modal.style.zIndex = '-1';
                });
            });
        });

        window.addEventListener('click', (event) => {
            if (event.target === typeModal) typeModal.style.display = 'none';
            if (event.target === humanModal) humanModal.style.display = 'none';
            if (event.target === otherModal) otherModal.style.display = 'none';
            if (event.target === detailViewModal) detailViewModal.style.display = 'none';
            if (event.target === aiChatModal) aiChatModal.style.display = 'none';

            [typeModal, humanModal, otherModal, detailViewModal, aiChatModal].forEach(modal => {
                if (modal.style.display === 'none') {
                    modal.style.zIndex = '-1';
                }
            });
        });

        document.getElementById('humanTypeBtn').addEventListener('click', () => {
            typeModal.style.display = 'none';
            populateSelectOptions();
            humanModal.style.display = 'flex';
            humanModal.style.zIndex = '1000';
        });

        document.getElementById('otherTypeBtn').addEventListener('click', () => {
            typeModal.style.display = 'none';
            otherModal.style.display = 'flex';
            otherModal.style.zIndex = '1000';
        });

        document.getElementById('cancelHumanBtn').addEventListener('click', () => {
            humanModal.style.display = 'none';
            humanModal.style.zIndex = '-1';
        });

        document.getElementById('cancelOtherBtn').addEventListener('click', () => {
            otherModal.style.display = 'none';
            otherModal.style.zIndex = '-1';
        });

        document.getElementById('closeDetail').addEventListener('click', () => {
            detailViewModal.style.display = 'none';
            detailViewModal.style.zIndex = '-1';
        });

        document.getElementById('closeAIChat').addEventListener('click', () => {
            aiChatModal.style.display = 'none';
            aiChatModal.style.zIndex = '-1';
        });

        aiChatModal.addEventListener('click', (event) => {
            if (event.target === aiChatModal) {
                aiChatModal.style.display = 'none';
                aiChatModal.style.zIndex = '-1';
            }
        });

        document.getElementById('editEntryBtn').addEventListener('click', () => {
            const data = document.currentDetailData;
            if (!data) return;

            detailViewModal.style.display = 'none';
            detailViewModal.style.zIndex = '-1';

            if (data.type === 'human') {
                openHumanFormForEdit(data);
                humanModal.style.zIndex = '1000';
            } else {
                openOtherFormForEdit(data);
                otherModal.style.zIndex = '1000';
            }
        });

        document.getElementById('deleteEntryBtn').addEventListener('click', () => {
            deleteCurrentEntry();
        });

        aiSendBtn.addEventListener('click', () => {
            const command = aiInput.value.trim();
            if (command) {
                processAICommand(command);
            }
        });

        aiInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !aiSendBtn.disabled) {
                const command = aiInput.value.trim();
                if (command) {
                    processAICommand(command);
                }
            }
        });

        document.getElementById('humanForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const id = document.getElementById('humanId').value;
            const name = document.getElementById('humanName').value;
            const gender = document.getElementById('humanGender').value;
            const birthDate = document.getElementById('birthDate').value;
            const extraNotes = document.getElementById('extraNotes').value;

            const friendsSelect = document.getElementById('friends');
            const familySelect = document.getElementById('family');

            const selectedFriends = Array.from(friendsSelect.selectedOptions).map(option => option.value);
            const selectedFamily = Array.from(familySelect.selectedOptions).map(option => option.value);

            const tagsSelect = document.getElementById('humanTags');
            const selectedTags = Array.from(tagsSelect.selectedOptions).map(option => option.value);

            if (id) {

                const humanIndex = pazatorData.humans.findIndex(h => h.id === id);
                if (humanIndex !== -1) {

                    const existingImage = pazatorData.humans[humanIndex].imagePreview;

                    pazatorData.humans[humanIndex] = {
                        id,
                        name,
                        gender,
                        birthDate,
                        friends: selectedFriends,
                        family: selectedFamily,
                        extraNotes,
                        tags: selectedTags,
                        imagePreview: existingImage
                    };
                }
            } else {

                const newHuman = {
                    id: Date.now().toString(),
                    name,
                    gender,
                    birthDate,
                    friends: selectedFriends,
                    family: selectedFamily,
                    extraNotes,
                    tags: selectedTags,
                    imagePreview: null
                };

                pazatorData.humans.push(newHuman);
            }

            const imageFile = document.getElementById('humanImage').files[0];
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    if (id) {

                        const humanIndex = pazatorData.humans.findIndex(h => h.id === id);
                        if (humanIndex !== -1) {
                            pazatorData.humans[humanIndex].imagePreview = e.target.result;
                        }
                    } else {

                        const lastIndex = pazatorData.humans.length - 1;
                        pazatorData.humans[lastIndex].imagePreview = e.target.result;
                    }

                    saveData();
                    renderWebNodes();
                    humanModal.style.display = 'none';
                    humanModal.style.zIndex = '-1';
                    document.getElementById('humanForm').reset();
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveData();
                renderWebNodes();
                humanModal.style.display = 'none';
                humanModal.style.zIndex = '-1';
                document.getElementById('humanForm').reset();
            }
        });

        document.getElementById('otherForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const id = document.getElementById('otherId').value;
            const name = document.getElementById('otherName').value;
            const note = document.getElementById('otherNote').value;

            if (id) {

                const otherIndex = pazatorData.others.findIndex(o => o.id === id);
                if (otherIndex !== -1) {

                    const existingImage = pazatorData.others[otherIndex].imagePreview;

                    pazatorData.others[otherIndex] = {
                        id,
                        name,
                        note,
                        imagePreview: existingImage
                    };
                }
            } else {

                const newOther = {
                    id: Date.now().toString(),
                    name,
                    note,
                    imagePreview: null
                };

                pazatorData.others.push(newOther);
            }

            const imageFile = document.getElementById('otherImage').files[0];
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    if (id) {

                        const otherIndex = pazatorData.others.findIndex(o => o.id === id);
                        if (otherIndex !== -1) {
                            pazatorData.others[otherIndex].imagePreview = e.target.result;
                        }
                    } else {

                        const lastIndex = pazatorData.others.length - 1;
                        pazatorData.others[lastIndex].imagePreview = e.target.result;
                    }

                    saveData();
                    renderWebNodes();
                    otherModal.style.display = 'none';
                    otherModal.style.zIndex = '-1';
                    document.getElementById('otherForm').reset();
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveData();
                renderWebNodes();
                otherModal.style.display = 'none';
                otherModal.style.zIndex = '-1';
                document.getElementById('otherForm').reset();
            }
        });

        window.addEventListener('resize', () => {
            renderWebNodes();
        });

        applyFilterBtn.addEventListener('click', () => {
            renderWebNodes();
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                renderWebNodes();
            }
        });

        addTagBtn.addEventListener('click', () => {
            const tagText = tagInput.value.trim();
            if (tagText && !tags.includes(tagText)) {
                tags.push(tagText);
                renderTags();
                tagInput.value = '';
            }
        });

        refreshViewBtn.addEventListener('click', () => {
            renderWebNodes();
        });

        toggleConnectionsBtn.addEventListener('click', () => {
            const connectionLines = document.querySelectorAll('.connection-line');
            connectionLines.forEach(line => {
                line.style.display = line.style.display === 'none' ? 'block' : 'none';
            });
        });

        showStatisticsBtn.addEventListener('click', () => {
            const humanCount = pazatorData.humans.length;
            const otherCount = pazatorData.others.length;
            const totalConnections = pazatorData.humans.reduce((total, human) => {
                return total + (human.family ? human.family.length : 0) + (human.friends ? human.friends.length : 0);
            }, 0);

            alert(`Statistics:
- Humans: ${humanCount}
- Others: ${otherCount}
- Total Entries: ${humanCount + otherCount}
- Connections: ${totalConnections}`);
        });

        loadData();
        renderTags();
    </script>
</body>

</html>